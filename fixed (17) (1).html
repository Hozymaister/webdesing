<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vylepšená Kalkulačka Bezpečnostních Služeb</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand-accent: #d4a276;
            --brand-accent-light: #e6b991;
            --bg-dark: #0d0d0d;
            --bg-card: #1a1a1a;
            --bg-glass: rgba(20, 20, 20, 0.6);
            --text-light: #f5f5f5;
            --text-muted: #b0b0b0;
            --border-color: rgba(212, 162, 118, 0.2);
            --accent-glow: rgba(212, 162, 118, 0.4);
            --error-color: #e53e3e;
            --error-glow: rgba(229, 62, 62, 0.4);
            --font-heading: 'Poppins', sans-serif;
            --font-body: 'Nunito Sans', sans-serif;
            --radius: 16px;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: var(--font-body);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem 1rem;
            overflow: hidden;
            position: relative;
        }

        .aurora-background {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
        }

        .aurora-shape {
            position: absolute; border-radius: 50%;
            filter: blur(120px); opacity: 0.15;
        }

        .shape1 {
            width: 500px; height: 500px;
            background: var(--brand-accent);
            top: 5%; left: 15%;
            animation: move-aurora 20s infinite alternate ease-in-out;
        }

        .shape2 {
            width: 400px; height: 400px;
            background: #833ab4;
            bottom: 5%; right: 15%;
            animation: move-aurora 25s infinite alternate-reverse ease-in-out;
        }

        @keyframes move-aurora {
            from { transform: translate(-50px, -50px) rotate(0deg) scale(1); }
            to { transform: translate(50px, 50px) rotate(90deg) scale(1.2); }
        }

        .calculator-container {
            width: 100%;
            max-width: 1100px;
            min-height: 70vh;
            display: grid;
            grid-template-columns: 280px 1fr;
            background: var(--bg-glass);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            box-shadow: 0 25px 60px rgba(0,0,0,0.7);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }
        
        .calculator-container::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: var(--context-bg, none);
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: -1;
            border-radius: var(--radius);
            filter: blur(2px);
        }
        
        .calculator-container.has-bg::before {
            opacity: 0.08;
        }

        h2, h3 {
            font-family: var(--font-heading);
            font-weight: 700;
            line-height: 1.3;
            color: var(--text-light);
            text-align: center;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        h2 { font-size: clamp(1.8rem, 4vw, 2.5rem); background: linear-gradient(145deg, var(--text-light), var(--text-muted)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        h3 { font-size: 1.3rem; color: var(--brand-accent); margin-bottom: 0.5rem;}
        p { text-align: center; color: var(--text-muted); max-width: 60ch; margin: 0 auto; }
        
        .calculator-sidebar {
            padding: 2rem 1rem;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header { margin-bottom: 2rem; text-align: center; }
        .sidebar-header h3 { font-size: 1.5rem; }
        .sidebar-header p { font-size: 0.9rem; }

        .service-nav { display: flex; flex-direction: column; gap: 0.5rem; }

        .service-nav-item {
            display: flex; align-items: center; gap: 1rem;
            padding: 0.8rem 1rem; border-radius: 12px;
            cursor: pointer; border: 1px solid transparent;
            background-color: transparent; width: 100%;
            text-align: left; color: var(--text-muted);
            font-family: var(--font-body); font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        .service-nav-item:hover { background-color: rgba(255, 255, 255, 0.05); color: var(--text-light); }
        .service-nav-item.active { background-color: rgba(212, 162, 118, 0.1); color: var(--brand-accent-light); border-color: var(--brand-accent); }
        .service-nav-item svg { width: 28px; height: 28px; flex-shrink: 0; transition: color 0.3s ease; }

        .calculator-main {
            padding: 2.5rem;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .calculator-steps {
            position: relative;
            flex-grow: 1;
            min-height: 400px;
        }

        .calculator-step {
            position: absolute; width: 100%;
            opacity: 0; visibility: hidden;
            transform: translateY(20px);
            transition: opacity 0.4s ease, visibility 0.4s, transform 0.4s ease;
        }
        .calculator-step.active { opacity: 1; visibility: visible; transform: translateY(0); }
        
        .step-header { margin-bottom: 2rem; }
        .step2-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; }
        .form-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .form-group { animation: field-in 0.5s ease forwards; opacity: 0; transform: translateX(-10px); }
        @keyframes field-in { to { opacity: 1; transform: translateX(0); } }
        .form-grid label, .slider-group { display: flex; flex-direction: column; gap: .5rem; font-size: 0.9rem; font-weight: 600; color: var(--text-muted); }
        .slider-group .slider-label { display: flex; justify-content: space-between; align-items: center; }
        
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 4px;
            background: var(--border-color); border-radius: 2px;
            outline: none; margin-top: 0.5rem;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px;
            background: var(--brand-accent); cursor: pointer;
            border-radius: 50%; border: 3px solid var(--bg-dark);
            transition: background 0.3s ease;
        }
        input[type="range"]::-webkit-slider-thumb:hover { background: var(--brand-accent-light); }
        input[type="range"]::-moz-range-thumb {
             width: 14px; height: 14px;
            background: var(--brand-accent); cursor: pointer;
            border-radius: 50%; border: 3px solid var(--bg-dark);
        }

        .form-grid input, .form-grid select {
            background: var(--bg-dark); border: 1px solid var(--border-color);
            color: var(--text-light); padding: 0.8rem 1rem;
            border-radius: 12px; font-family: inherit;
            font-size: 1rem; width: 100%;
            transition: all 0.3s ease;
        }
        .form-grid input:focus, .form-grid select:focus {
            outline: none; border-color: var(--brand-accent);
            box-shadow: 0 0 15px var(--accent-glow), inset 0 0 5px rgba(212, 162, 118, 0.1);
            background-color: #222;
        }
        .form-grid input.invalid, .form-grid select.invalid {
            border-color: var(--error-color);
            box-shadow: 0 0 15px var(--error-glow), inset 0 0 5px rgba(229, 62, 62, 0.1);
        }
        
        .form-grid .checkbox-label {
            flex-direction: row; align-items: center; justify-content: flex-start;
            cursor: pointer; gap: 0.75rem;
            background-color: rgba(255,255,255,0.03);
            padding: 0.8rem 1rem; border-radius: 12px;
        }
        .form-grid .checkbox-label:hover { background-color: rgba(255,255,255,0.07); }
        .form-grid .checkbox-label input[type="checkbox"] { width: 1.2em; height: 1.2em; accent-color: var(--brand-accent); order: -1; }

        .summary-panel {
            background-color: rgba(0,0,0,0.2); border-radius: var(--radius);
            padding: 1.5rem; border: 1px solid var(--border-color);
            height: fit-content; position: sticky; top: 2rem;
        }
        .summary-panel h4 { text-align: left; color: var(--text-light); }
        .summary-panel ul { list-style: none; margin-top: 1rem; padding-left: 0; }
        .summary-panel li { display: flex; align-items: flex-start; gap: 0.75rem; color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem;}
        .summary-panel li svg { width: 20px; height: 20px; color: var(--brand-accent); flex-shrink: 0; margin-top: 2px;}
        .summary-panel li div { display: flex; flex-direction: column;}
        .summary-panel li .summary-value { color: var(--text-light); font-weight: 600; }

        .navigation-buttons { display: flex; justify-content: flex-end; align-items: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.8rem 1.8rem; border-radius: 12px; font-weight: 700; font-family: var(--font-body); text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s ease; cursor: pointer; border: none; text-decoration: none; position: relative; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .btn-primary { background: linear-gradient(145deg, var(--brand-accent-light), var(--brand-accent)); color: var(--bg-dark); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .btn-primary::before { content: ''; position: absolute; inset: -2px; border-radius: inherit; background: linear-gradient(145deg, var(--brand-accent-light), var(--brand-accent)); filter: blur(10px); opacity: 0.7; z-index: -1; transition: opacity 0.3s ease; animation: pulse-glow 3s infinite ease-in-out; }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        .btn-primary:not(:disabled):hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 25px rgba(0,0,0,0.4); }
        .btn-primary:not(:disabled):hover::before { opacity: 1; }
        .btn-restart { background: transparent; color: var(--text-muted); border: 1px solid var(--border-color); margin: 1.5rem auto 0 auto; }
        .btn-restart:hover { background-color: var(--bg-card); color: var(--text-light); border-color: var(--brand-accent); }
        
        .result-card { background: rgba(0,0,0,0.2); border: 1px solid var(--brand-accent); border-radius: var(--radius); padding: 2.5rem 2rem; text-align: center; }
        .result-title { font-size: 1.1rem; color: var(--text-muted); font-weight: 400; margin-bottom: 0.5rem; }
        .result-estimate { font-size: clamp(2.2rem, 7vw, 3.5rem); font-family: var(--font-heading); color: var(--brand-accent); text-shadow: 0 0 20px var(--accent-glow); margin-bottom: 1rem; }
        .result-details { font-size: 1rem; color: var(--text-light); max-width: 60ch; margin: 0 auto 1.5rem auto; opacity: 0.9; border-top: 1px solid var(--border-color); padding-top: 1.5rem; }
        .result-summary { list-style: none; padding: 0; max-width: 400px; margin: 0 auto 1.5rem; }
        .result-summary li { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color); }
        .result-summary li span:first-child { color: var(--text-muted); }
        .result-summary li span:last-child { color: var(--text-light); font-weight: 600; }
        .output-note { font-size: 0.9rem; margin-top: 1.5rem; color: var(--text-muted); }

        @media (max-width: 900px) {
            .calculator-container { grid-template-columns: 1fr; min-height: 80vh; max-height: 90vh; overflow-y: auto;}
            .calculator-sidebar { border-right: none; border-bottom: 1px solid var(--border-color); padding: 1.5rem; }
            .service-nav { flex-direction: row; flex-wrap: wrap; justify-content: center; }
            .calculator-main { padding: 1.5rem; }
            .step2-layout { grid-template-columns: 1fr; }
            .summary-panel { position: static; margin-top: 2rem; }
        }
    </style>
</head>
<body>
    <div class="aurora-background">
        <div class="aurora-shape shape1"></div>
        <div class="aurora-shape shape2"></div>
    </div>

    <div id="calculator-container" class="calculator-container">
        <aside class="calculator-sidebar">
            <div class="sidebar-header">
                <h3>Služby</h3>
                <p>Vyberte si oblast</p>
            </div>
            <nav id="service-nav" class="service-nav">
                <button class="service-nav-item" data-service="object" data-bg="https://images.unsplash.com/photo-1581092446347-a8b2f1597a1d?auto=format&fit=crop&w=800&q=60">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M54 57H10C8.89543 57 8 56.1046 8 55V15C8 13.8954 8.89543 13 10 13H54C55.1046 13 56 13.8954 56 15V55C56 56.1046 55.1046 57 54 57Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 13V9C18 7.89543 18.8954 7 20 7H44C45.1046 7 46 7.89543 46 9V13" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 23H26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 33H26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 43H26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M38 23H42" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M38 33H42" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M38 43H42" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Ostraha objektu</span>
                </button>
                 <button class="service-nav-item" data-service="vip" data-bg="https://images.unsplash.com/photo-1621601433342-23736822b311?auto=format&fit=crop&w=800&q=60">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 30C37.5228 30 42 25.5228 42 20C42 14.4772 37.5228 10 32 10C26.4772 10 22 14.4772 22 20C22 25.5228 26.4772 30 32 30Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M48.61 54C48.61 47.9 41.1 43 32 43C22.9 43 15.39 47.9 15.39 54" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M51 7L57 13" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 13L13 7" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Osobní ochrana</span>
                </button>
                <button class="service-nav-item" data-service="event" data-bg="https://images.unsplash.com/photo-1511795409834-ef04bbd51622?auto=format&fit=crop&w=800&q=60">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14 26L32 12L50 26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 32V52H46V32" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M26 52V40C26 37.7909 27.7909 36 30 36H34C36.2091 36 38 37.7909 38 40V52" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M55 42L50 45" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 42L14 45" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M52 30L56 26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 30L8 26" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Event security</span>
                </button>
                <button class="service-nav-item" data-service="sport" data-bg="https://images.unsplash.com/photo-1541250848049-b9f71a6e8e88?auto=format&fit=crop&w=800&q=60">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 57C45.8071 57 57 45.8071 57 32C57 18.1929 45.8071 7 32 7C18.1929 7 7 18.1929 7 32C7 45.8071 18.1929 57 32 57Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M32 7C27.5 16.5 27.5 22.5 32 32C36.5 22.5 36.5 16.5 32 7Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M57 32C47.5 36.5 41.5 36.5 32 32C41.5 27.5 47.5 27.5 57 32Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 32H57" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M32 7V57" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Sportovní utkání</span>
                </button>
                <button class="service-nav-item" data-service="club" data-bg="https://images.unsplash.com/photo-1582220107107-590426d242c8?auto=format&fit=crop&w=800&q=60">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 20C32 15.5817 28.4183 12 24 12C19.5817 12 16 15.5817 16 20C16 23.5 18.5 26.3 21.6 27.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M48 20C48 15.5817 44.4183 12 40 12C35.5817 12 32 15.5817 32 20C32 23.5 34.5 26.3 37.6 27.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 20H10C8.89543 20 8 20.8954 8 22V50C8 51.1046 8.89543 52 10 52H54C55.1046 52 56 51.1046 56 50V22C56 20.8954 55.1046 20 54 20H48" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M32 28V38L40 43" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span>Noční podniky</span>
                </button>
            </nav>
        </aside>
        <main class="calculator-main">
            <form id="estimator-form" onsubmit="event.preventDefault();">
                <div class="calculator-steps">
                    <div class="calculator-step active" data-step="1">
                        <div class="step-header" style="margin-top: 4rem;">
                            <h2>Plánovač bezpečnosti</h2>
                            <p>Začněte výběrem služby v levém panelu a vytvořte si orientační návrh na míru.</p>
                        </div>
                    </div>
                    <div class="calculator-step" data-step="2">
                        <div class="step-header">
                            <h3 id="step2-title">Specifikace služby</h3>
                        </div>
                        <div class="step2-layout">
                            <div id="form-fields-container" class="form-grid"></div>
                             <aside id="summary-panel" class="summary-panel"></aside>
                        </div>
                    </div>
                    <div class="calculator-step" data-step="3">
                        <div id="result-container" class="result-card"></div>
                    </div>
                </div>
                
                <select name="service_type" id="service-type-select" style="display:none;">
                    <option value=""></option>
                    <option value="object">Ostraha objektu</option>
                    <option value="vip">Osobní ochrana</option>
                    <option value="event">Event security</option>
                    <option value="sport">Sportovní utkání</option>
                    <option value="club">Noční podniky</option>
                </select>

                <div class="navigation-buttons">
                    <button type="button" id="btn-calculate" class="btn btn-primary" style="display: none;">Vypočítat odhad</button>
                </div>
            </form>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('estimator-form');
            const btnCalculate = document.getElementById('btn-calculate');
            const steps = document.querySelectorAll('.calculator-step');
            const serviceTypeSelect = document.getElementById('service-type-select');
            const fieldsContainer = document.getElementById('form-fields-container');
            const resultContainer = document.getElementById('result-container');
            const step2Title = document.getElementById('step2-title');
            const summaryPanel = document.getElementById('summary-panel');
            const calculatorContainer = document.getElementById('calculator-container');

            let currentStep = 1;

            const fieldTemplates = {
                object: `
                    <div class="form-group" style="animation-delay: 0.1s;"><label>Typ objektu <select name="object_type" required><option value="Kanceláře">Kanceláře</option><option value="Sklad">Sklad</option><option value="Stavba">Stavba</option><option value="Obchodní centrum">Obchodní centrum</option></select></label></div>
                    <div class="form-group slider-group" style="animation-delay: 0.2s;">
                        <div class="slider-label"><span>Rozloha (m²)</span><input type="number" name="area" min="50" max="50000" value="1000" required></div>
                        <input type="range" data-sync="area" min="50" max="50000" value="1000" step="50">
                    </div>
                    <div class="form-group slider-group" style="animation-delay: 0.3s;">
                         <div class="slider-label"><span>Počet vstupů</span><input type="number" name="entrances_object" min="1" max="50" value="1" required></div>
                         <input type="range" data-sync="entrances_object" min="1" max="50" value="1">
                    </div>
                    <div class="form-group" style="animation-delay: 0.4s;"><label>Provoz<select name="operation_time" required><option value="Denní">Denní</option><option value="24/7">24/7</option></select></label></div>
                    <label class="form-group checkbox-label" style="animation-delay: 0.5s;">
                        Má kamerový systém?
                        <input type="checkbox" name="cctv">
                    </label>
                `,
                vip: `
                    <div class="form-group slider-group" style="animation-delay: 0.1s;">
                         <div class="slider-label"><span>Počet chráněných osob</span><input type="number" name="vip_count" min="1" max="20" value="1" required></div>
                         <input type="range" data-sync="vip_count" min="1" max="20" value="1">
                    </div>
                    <div class="form-group" style="animation-delay: 0.2s;"><label>Rizikovost <select name="risk_vip" required><option value="1">Nízká</option><option value="1.5">Střední</option><option value="2">Vysoká</option></select></label></div>
                    <div class="form-group" style="animation-delay: 0.3s;"><label>Pohyb <select name="movement" required><option value="Pevná lokalita">Pevná lokalita</option><option value="Cestování">Cestování</option></select></label></div>
                    <label class="form-group checkbox-label" style="animation-delay: 0.4s;">
                        Potřebujete řidiče-bodyguarda?
                        <input type="checkbox" name="driver">
                    </label>
                `,
                event: `
                    <div class="form-group slider-group" style="animation-delay: 0.1s;">
                         <div class="slider-label"><span>Očekávaný počet návštěvníků</span><input type="number" name="attendees_event" min="10" max="100000" value="500" required></div>
                         <input type="range" data-sync="attendees_event" min="10" max="100000" value="500" step="10">
                    </div>
                    <div class="form-group slider-group" style="animation-delay: 0.2s;">
                         <div class="slider-label"><span>Trvání akce (hodiny)</span><input type="number" name="duration_event" min="1" max="72" value="8" required></div>
                         <input type="range" data-sync="duration_event" min="1" max="72" value="8">
                    </div>
                    <div class="form-group" style="animation-delay: 0.3s;"><label>Rizikovost <select name="risk_event" required><option value="1">Nízká</option><option value="1.3">Střední</option><option value="1.6">Vysoká</option></select></label></div>
                    <div class="form-group" style="animation-delay: 0.4s;"><label>Prostředí<select name="venue_type" required><option value="indoor">Vnitřní</option><option value="outdoor">Venkovní</option></select></label></div>
                    <label class="form-group checkbox-label" style="animation-delay: 0.5s;">
                        Podává se alkohol?
                        <input type="checkbox" name="alcohol">
                    </label>
                `,
                sport: `
                    <div class="form-group slider-group" style="animation-delay: 0.1s;">
                         <div class="slider-label"><span>Očekávaný počet diváků</span><input type="number" name="attendees_sport" min="10" max="80000" value="500" required></div>
                         <input type="range" data-sync="attendees_sport" min="10" max="80000" value="500" step="10">
                    </div>
                     <div class="form-group slider-group" style="animation-delay: 0.2s;">
                         <div class="slider-label"><span>Trvání akce (hodiny)</span><input type="number" name="duration_sport" min="1" max="12" value="4" required></div>
                         <input type="range" data-sync="duration_sport" min="1" max="12" value="4">
                    </div>
                    <div class="form-group" style="animation-delay: 0.3s;"><label>Rizikovost <select name="risk_sport" required><option value="1">Běžné</option><option value="1.5">Derby</option><option value="2">Vysoké riziko</option></select></label></div>
                    <label class="form-group checkbox-label" style="animation-delay: 0.4s;">
                        Oddělený sektor hostů?
                        <input type="checkbox" name="guest_sector">
                    </label>
                `,
                club: `
                    <div class="form-group slider-group" style="animation-delay: 0.1s;">
                         <div class="slider-label"><span>Kapacita podniku</span><input type="number" name="club_capacity" value="150" min="20" max="2000" required></div>
                         <input type="range" data-sync="club_capacity" min="20" max="2000" value="150" step="10">
                    </div>
                    <div class="form-group slider-group" style="animation-delay: 0.2s;">
                         <div class="slider-label"><span>Počet vstupů</span><input type="number" name="entrances_club" value="1" min="1" max="10" required></div>
                         <input type="range" data-sync="entrances_club" min="1" max="10" value="1">
                    </div>
                    <div class="form-group" style="animation-delay: 0.3s;"><label>Rizikovost lokality <select name="risk_club" required><option value="1">Nízká</option><option value="1.3">Střední</option><option value="1.6">Vysoká</option></select></label></div>
                `
            };

            const summaryLabels = {
                object: [
                    { name: 'object_type', label: 'Typ objektu' },
                    { name: 'area', label: 'Rozloha (m²)', format: value => `${value} m²` },
                    { name: 'entrances_object', label: 'Počet vstupů' },
                    { name: 'operation_time', label: 'Provoz' },
                    { name: 'cctv', label: 'Kamerový systém', type: 'boolean' }
                ],
                vip: [
                    { name: 'vip_count', label: 'Chráněných osob' },
                    { name: 'risk_vip', label: 'Rizikovost', format: value => ({ '1': 'Nízká', '1.5': 'Střední', '2': 'Vysoká' }[value] || value) },
                    { name: 'movement', label: 'Pohyb' },
                    { name: 'driver', label: 'Řidič-bodyguard', type: 'boolean' }
                ],
                event: [
                    { name: 'attendees_event', label: 'Návštěvníků' },
                    { name: 'duration_event', label: 'Trvání akce', format: value => `${value} hod.` },
                    { name: 'risk_event', label: 'Rizikovost', format: value => ({ '1': 'Nízká', '1.3': 'Střední', '1.6': 'Vysoká' }[value] || value) },
                    { name: 'venue_type', label: 'Prostředí', format: value => value === 'outdoor' ? 'Venkovní' : 'Vnitřní' },
                    { name: 'alcohol', label: 'Podává se alkohol', type: 'boolean' }
                ],
                sport: [
                    { name: 'attendees_sport', label: 'Diváků' },
                    { name: 'duration_sport', label: 'Trvání', format: value => `${value} hod.` },
                    { name: 'risk_sport', label: 'Riziko', format: value => ({ '1': 'Běžné', '1.5': 'Derby', '2': 'Vysoké riziko' }[value] || value) },
                    { name: 'guest_sector', label: 'Oddělený sektor hostů', type: 'boolean' }
                ],
                club: [
                    { name: 'club_capacity', label: 'Kapacita', format: value => `${value} osob` },
                    { name: 'entrances_club', label: 'Vstupy' },
                    { name: 'risk_club', label: 'Rizikovost', format: value => ({ '1': 'Nízká', '1.3': 'Střední', '1.6': 'Vysoká' }[value] || value) }
                ]
            };
            
            function goToStep(stepNumber) {
                currentStep = stepNumber;
                steps.forEach(step => step.classList.remove('active'));
                document.querySelector(`.calculator-step[data-step="${currentStep}"]`).classList.add('active');
                btnCalculate.style.display = (currentStep === 2) ? 'inline-flex' : 'none';
            }
            
            document.querySelectorAll('.service-nav-item').forEach(button => {
                button.addEventListener('click', () => {
                    const service = button.dataset.service;
                    const serviceName = button.querySelector('span').textContent;
                    
                    document.querySelectorAll('.service-nav-item').forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    calculatorContainer.style.setProperty('--context-bg', `url(${button.dataset.bg})`);
                    calculatorContainer.classList.add('has-bg');

                    serviceTypeSelect.value = service;
                    step2Title.textContent = serviceName;
                    
                    fieldsContainer.innerHTML = fieldTemplates[service];
                    attachFieldListeners();
                    updateSummary();
                    validateCurrentStep();
                    goToStep(2);
                });
            });

            function attachFieldListeners() {
                const fields = fieldsContainer.querySelectorAll('input, select');
                fields.forEach(el => {
                    if (el.dataset.sync) {
                        el.addEventListener('input', () => {
                            const numberInput = fieldsContainer.querySelector(`input[name="${el.dataset.sync}"]`);
                            if(numberInput) numberInput.value = el.value;
                            validateField(el);
                            validateCurrentStep();
                            updateSummary();
                        });
                    } else if (el.type === 'number') {
                        el.addEventListener('input', () => {
                            const rangeInput = fieldsContainer.querySelector(`input[data-sync="${el.name}"]`);
                            if(rangeInput) rangeInput.value = el.value;
                            validateField(el);
                            validateCurrentStep();
                            updateSummary();
                        });
                    } else {
                        el.addEventListener('input', () => {
                            validateField(el);
                            validateCurrentStep();
                            updateSummary();
                        });
                    }
                });
            }

            function validateField(element) {
                 if (element.checkValidity()) element.classList.remove('invalid');
                 else element.classList.add('invalid');
            }

            function validateCurrentStep() {
                if (currentStep !== 2) return true;
                const fields = fieldsContainer.querySelectorAll('input[required], select[required]');
                let isStepValid = Array.from(fields).every(field => field.checkValidity());
                btnCalculate.disabled = !isStepValid;
                return isStepValid;
            }

            btnCalculate.addEventListener('click', () => {
                if (validateCurrentStep()) {
                    calculateEstimate();
                    goToStep(3);
                }
            });

            function updateSummary() {
                const service = serviceTypeSelect.value;
                if (!service || !summaryLabels[service]) {
                    summaryPanel.innerHTML = `<h4>Souhrn</h4><p style="text-align:left; font-size: 0.8rem;">Vyberte službu a vyplňte detaily pro zobrazení souhrnu.</p>`;
                    return;
                }

                const data = new FormData(form);
                const items = summaryLabels[service]
                    .map(({ name, label, format, type }) => {
                        const isBoolean = type === 'boolean';
                        const rawValue = isBoolean ? data.getAll(name).includes('on') : data.get(name);
                        if (!isBoolean && (rawValue === null || rawValue === '')) {
                            return null;
                        }

                        const displayValue = typeof format === 'function'
                            ? format(isBoolean ? (rawValue ? 'on' : '') : rawValue)
                            : (isBoolean ? (rawValue ? 'Ano' : 'Ne') : rawValue ?? '—');

                        return `<li><div><span class="summary-value">${label}</span><span>${displayValue}</span></div></li>`;
                    })
                    .filter(Boolean)
                    .join('');

                summaryPanel.innerHTML = `
                    <h4>Souhrn</h4>
                    <ul>${items || '<li><div><span>Zatím žádné údaje</span></div></li>'}</ul>
                `;
            }

            function calculateEstimate() {
                const fData = new FormData(form);
                const f = Object.fromEntries(fData.entries());
                const service = serviceTypeSelect.value;
                let estimate = 'Nespecifikováno';
                let summaryHtml = '';

                 try {
                     switch (service) {
                        case 'object':
                            const area = +f.area || 0;
                            const entrances = +f.entrances_object || 1;
                            let baseObj = (area / 2000) + entrances;
                            if (f.cctv) baseObj *= 0.8;
                            let final = Math.max(1, Math.ceil(baseObj));
                            estimate = f.operation_time === '24/7' ? `${final * 2}-${final * 3} ve směnách` : `${final}-${final + 1} na směnu`;
                            summaryHtml = `<li><span>Typ:</span><span>${f.object_type}</span></li><li><span>Rozloha:</span><span>${area} m²</span></li><li><span>Vstupy:</span><span>${entrances}</span></li>`;
                            break;
                        case 'vip':
                            let baseVip = Math.ceil((+f.vip_count || 1) * (+f.risk_vip || 1));
                            if (f.movement === 'Cestování') baseVip += 1; 
                            if (f.driver) baseVip += 1;
                            estimate = baseVip === 1 ? '1 bodyguard' : `${baseVip}-${baseVip + 1} bodyguardi`;
                            summaryHtml = `<li><span>Počet osob:</span><span>${f.vip_count}</span></li><li><span>Rizikovost:</span><span>${f.risk_vip > 1.5 ? 'Vysoká' : f.risk_vip > 1 ? 'Střední' : 'Nízká'}</span></li>`;
                            break;
                        case 'event':
                            let attendees = +f.attendees_event || 0;
                            let ratio;
                            if (attendees <= 1000) {
                                ratio = 100;
                            } else if (attendees <= 10000) {
                                ratio = 150;
                            } else {
                                ratio = 250;
                            }
                            let baseEvent = attendees / (ratio / (+f.risk_event || 1));
                            if (f.alcohol) baseEvent *= 1.25;
                            if (f.venue_type === 'outdoor') baseEvent *= 1.2;
                            const guards = Math.ceil(baseEvent);
                            const supervisors = Math.max(1, Math.ceil(guards / 10));
                            estimate = `${guards + supervisors} na směnu`;
                            summaryHtml = `<li><span>Návštěvníků:</span><span>${attendees}</span></li><li><span>Délka:</span><span>${f.duration_event} hod.</span></li><li><span>Prostředí:</span><span>${f.venue_type === 'outdoor' ? 'Venkovní': 'Vnitřní'}</span></li>`;
                            break;
                         case 'sport':
                            const spectators = +f.attendees_sport || 0;
                            let ratioSport;
                             if (spectators <= 5000) {
                                ratioSport = 100;
                            } else if (spectators <= 20000) {
                                ratioSport = 180;
                            } else {
                                ratioSport = 250;
                            }
                            let baseSport = spectators / (ratioSport / (+f.risk_sport || 1));
                            if (f.guest_sector) baseSport += Math.ceil(baseSport * 0.15) + 5;
                            const guardsSport = Math.ceil(baseSport);
                            const supSport = Math.max(1, Math.ceil(guardsSport / 12));
                            estimate = `${guardsSport + supSport} pořadatelů`;
                            summaryHtml = `<li><span>Diváků:</span><span>${spectators}</span></li><li><span>Riziko:</span><span>${f.risk_sport > 1.5 ? 'Vysoké' : f.risk_sport > 1 ? 'Derby' : 'Běžné'}</span></li>`;
                            break;
                        case 'club':
                            let ratioClub = 75 / (+f.risk_club || 1);
                            let baseClub = (+f.club_capacity || 0) / ratioClub + (+f.entrances_club || 1);
                            const guardsClub = Math.ceil(baseClub);
                            estimate = `${guardsClub}-${guardsClub + 1} pracovníci`;
                            summaryHtml = `<li><span>Kapacita:</span><span>${f.club_capacity}</span></li><li><span>Vstupy:</span><span>${f.entrances_club}</span></li>`;
                            break;
                    }
                } catch (e) {
                    console.error("Chyba výpočtu:", e);
                    estimate = 'Chyba';
                }
                
                resultContainer.innerHTML = `
                    <div class="result-title">Doporučený počet</div>
                    <div class="result-estimate">${estimate}</div>
                    <div class="result-details">
                        <h4>Souhrn vašeho zadání</h4>
                        <ul class="result-summary">${summaryHtml}</ul>
                    </div>
                    <p class="output-note">Toto je pouze orientační odhad. Pro přesnou nabídku nás prosím kontaktujte.</p>
                    <button type="button" class="btn btn-restart">Zpět na výběr služeb</button>
                `;
                
                resultContainer.querySelector('.btn-restart').addEventListener('click', () => {
                    calculatorContainer.classList.remove('has-bg');
                    document.querySelectorAll('.service-nav-item').forEach(b => b.classList.remove('active'));
                    serviceTypeSelect.value = '';
                    fieldsContainer.innerHTML = '';
                    summaryPanel.innerHTML = `<h4>Souhrn</h4><p style="text-align:left; font-size: 0.8rem;">Vyberte službu a vyplňte detaily pro zobrazení souhrnu.</p>`;
                    goToStep(1);
                });
            }
        });
    </script>
</body>
</html>
